<%- if @ranks.present? -%>
<%= javascript_tag do -%>
$(document).ready(function () {
  $.ajax({
    url: '/_api/rank/piece_ranks',
    type: 'GET',
    data: {content_id: <%= @piece.content.id %>, piece_id: <%= @piece.id %>, version: '20150401'},
    success: function (data) {
      var wrapper = $('#<%= @piece.name %> > .pieceContainer > .pieceBody');
      var ranks = data['ranks'];
      var more = data['more'];
      if (ranks) {
        var u = $('<ul>');
        $(ranks).each(function (index, item) {
          var i = index + 1;
          var l = $('<li>');
          if (i <= 10) l.attr('class', 'ranking'+i);
          l.append($('<span>', {class: 'rank', text: i}));
          l.append($('<a>', {href: item['url'], target: '_blank', text: item['title']}));
          if (item['count'] !== null) l.append($('<span>', {class: 'count', text: '('+item['count']+')'}));
          u.append(l);
        });
        wrapper.append(u);
      }
      if (more) {
        var d = $('<div>', {class: 'more'});
        d.append($('<a>', {href: more['url'], text: more['body']}));
        wrapper.append(d);
      }
    },
    error: function (data)  {
      var wrapper = $('#<%= @piece.name %> > .pieceContainer > .pieceBody');
      wrapper.text('現在表示できません。');
    }
  });
});
<%- end -%>
<%- end -%>
